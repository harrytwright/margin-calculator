# Repository Guidelines

## Project Structure & Module Organization

- `src/` houses the TypeScript CLI, with `src/commands` for subcommands, `src/services` for business logic, and `src/lib` for shared utilities and calculation helpers.
- Tests live beside code in `__tests__` directories (for example `src/services/__tests__/recipe.test.ts`); `dist/` contains compiled output generated by the build pipeline.
- Reference data under `data/`, Prisma schema and migrations in `prisma/`, public assets under `src/server/public`, and reusable templates in `templates/`.

## Build, Test, and Development Commands

- `npm run build` transpiles TypeScript using `tsconfig.build.json` and copies static web assets into `dist/server`.
- `npm test` runs the Jest suite once; use `npm run test:watch` while iterating and `npm run test:coverage` to inspect gaps before opening a PR.
- `npm run generate:database` regenerates database types after editing `prisma/schema.prisma`.
- `node dist/index.js initialise --working ./sandbox` bootstraps a workspace; follow with `node dist/index.js ui` to exercise the web UI locally.
- The UI server watches `working/data` for edits by default; opt out with `--no-watch`. For CLI-only workflows run `node dist/index.js import --watch` to stream updates into the database as files change.

## Coding Style & Naming Conventions

- Run Prettier before committing (`npx prettier --check .`); the config enforces two-space indentation, single quotes, and no semicolons.
- Prefer descriptive kebab-case for file names (`margin-report.ts`) and camelCase for variables and functions; exported classes stay in PascalCase.
- Keep CLI command modules focused and colocate adapters (database, YAML) under `src/services` to match existing conventions.

## Testing Guidelines

- Write Jest tests in `__tests__` folders with filenames ending in `.test.ts`; mirror the source path to make discovery straightforward.
- Cover new logic with deterministic fixtures; when altering import or calculation flows, assert on both happy path and error states.
- Update snapshots cautiously and review coverage deltas via `npm run test:coverage` before merging.

## Commit & Pull Request Guidelines

- Use Conventional Commits (`feat:`, `fix:`, `chore:`) as seen in `CHANGELOG.md`; group related changes into a single commit.
- PRs should describe the change set, list manual or automated checks run, and link any related issues; attach CLI output or screenshots when updating reports or the UI.
- Keep PRs small and focused; flag schema or data migrations explicitly and include regeneration steps.

## Data & Configuration Tips

- Treat anything in `data/` as sample fixtures; never commit secrets to `.env`.
- When modifying configuration defaults, document the new behavior in `docs/` and update the README command examples if needed.
- The UI consumes `/api/events` (SSE) to refresh automaticallyâ€”leave file watching enabled unless running in a constrained environment.
