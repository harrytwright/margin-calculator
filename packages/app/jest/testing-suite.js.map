{"version":3,"file":"testing-suite.js","sourceRoot":"/","sources":["../jest/testing-suite.ts"],"names":[],"mappings":"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","sourcesContent":["// Very, very, jammy, but it works lmao\n\n/* istanbul ignore next */\n\nimport './mocks/logger'\n\nimport { afterAll, beforeAll, expect, test } from '@jest/globals'\n\nimport util from 'util'\n\nimport { BuilderContext } from '@harrytwright/api/dist/builders/builder'\nimport { Constructable } from '@harrytwright/api/dist/common/interfaces'\nimport {\n  API,\n  BodyParser,\n  http,\n  NotFound,\n  useController,\n  useErrorHandler,\n  useMiddleware,\n} from '@harrytwright/api/dist/core'\nimport { Config } from '@harrytwright/cli-config'\nimport JsonWebToken from 'jsonwebtoken'\nimport supertest from 'supertest'\n\nimport { Container } from '@harrytwright/api/dist/core/injection/container'\nimport { Container as BaseContainer } from '@harrytwright/api/dist/injection'\nimport { ServiceIdentifier } from '@harrytwright/api/dist/injection/types/service-identifier.type'\nimport { AppConfig } from '../src/config'\nimport { KyselyDatastore } from '../src/datastore/kysely.datastore'\nimport handler from '../src/middleware/error-handler'\nimport { Auth, isValidPrivateKey } from '../src/modules/auth/auth.module'\nimport { Authentication } from '../src/modules/auth/middleware/authentication'\nimport { BullHandler } from '../src/modules/bull-mq/client/bull.handler'\nimport { RabbitmqClient } from '../src/modules/events/client/rabbitmq.client'\nimport { inflight } from '../src/modules/prometheus/middleware/inflight'\nimport { expressRequestHandler } from '../src/modules/sentry/middleware/wrapper'\nimport { Abort } from '../src/utils/abort'\nimport setupLog from '../src/utils/setup-log'\n\nexport { __unsafe_TestingSuite as TestingSuite } from '@harrytwright/api/dist/test/testing-suite'\nexport type { ITestingSuite } from '@harrytwright/api/dist/test/testing-suite'\n\n// Add logging here if we need it\nlet _logger: (msg: string, ...items: any[]) => unknown\nconst debug = (msg: string, ...items: any[]) => {\n  if (_logger !== undefined) return _logger(msg, ...items)\n\n  _logger = require('util').debug('testing-suite')\n}\n\n/* istanbul ignore next */\nexport function generateApplet(controller: Constructable<any>) {\n  // Try and keep this as close to real as possible\n  @http()\n  @useController(controller)\n  @useMiddleware(inflight)\n  @useMiddleware(expressRequestHandler())\n  @useMiddleware(Authentication)\n  @BodyParser.json({ type: ['application/*+json', 'application/json'] })\n  @NotFound()\n  @useErrorHandler(handler)\n  class App {}\n\n  return App\n}\n\n/* istanbul ignore next */\nexport function errorMessageShouldBe(message: any) {\n  return function (res: supertest.Response) {\n    expect(res.body).toBeDefined()\n    expect(res.body.error).toBeDefined()\n\n    if (message instanceof RegExp) {\n      expect(res.body.error.message).toMatch(message)\n    } else {\n      expect(res.body.error.message).toStrictEqual(message)\n    }\n  }\n}\n\nexport async function handle<A extends any>(\n  fn: Promise<A> | undefined,\n  callback: (err?: Error) => void\n): Promise<void> {\n  if (!fn) {\n    return Promise.resolve(callback(undefined))\n  }\n\n  try {\n    const value = await fn!\n    expect(value).toBeUndefined()\n  } catch (err: any) {\n    if ('matcherResult' in err) throw err\n    return callback(err)\n  }\n}\n\nconst hasOwnProperty = (obj: object, property: PropertyKey) =>\n  Object.prototype.hasOwnProperty.call(obj, property)\n\nexport function flatten(obj: Record<any, any>, deliminator: string = '.') {\n  const result: Record<any, any> = {}\n\n  for (const key in obj) {\n    if (!hasOwnProperty(obj, key)) continue\n\n    if (typeof obj[key] === 'object' && !!obj[key]) {\n      const child = flatten(obj[key])\n      for (const childKey in child) {\n        if (!hasOwnProperty(child, childKey)) continue\n        result[key + deliminator + childKey] = child[childKey]\n      }\n    } else {\n      result[key] = obj[key]\n    }\n  }\n\n  return result\n}\nexport function fatten(obj: Record<any, any>, deliminator: string = '.') {\n  const result: Record<any, any> = {}\n  for (const flattenedKey in obj) {\n    const keys = flattenedKey.split(deliminator)\n    keys.reduce(function (r, e, j) {\n      return (\n        r[e] ||\n        (r[e] = isNaN(Number(keys[j + 1]))\n          ? keys.length - 1 === j\n            ? obj[flattenedKey]\n            : {}\n          : [])\n      )\n    }, result)\n  }\n  return result\n}\n\nconst interpolationRegex = /\\${{\\s?([^{}]+)\\s?}}/g\n\nexport type Methods = 'GET' | 'POST' | 'PATCH' | 'PUT' | 'DELETE'\n\nexport type Exporter = {\n  path: string\n\n  regex?: string\n\n  default?: string\n}\n\nexport interface WorkFlow {\n  route: string\n  method: Methods\n  body?: any\n  auth?: boolean | string\n  headers?: Record<string, any>\n  tests?: { [key: 'status' | 'content-type' | 'body' | string]: any }[]\n  exports?: Record<string, string | Exporter>\n  name?: string\n  host?: string\n  wait?: number\n  timeout?: number\n}\n\nexport type WorkFlows = {\n  [key: string]: WorkFlow[]\n}\n\nexport type Hook = (\n  applet: BuilderContext | undefined,\n  ctx: Record<string, Record<string, any>>,\n  config?: Config<AppConfig>\n) => Promise<void>\n\nexport interface Hooks {\n  before?: Hook\n  after?: Hook\n}\n\nexport async function handleFlow(\n  workflow: WorkFlow[],\n  base: string | Constructable<any>,\n  runnerCtx: Record<string, any>,\n  hooks?: Hooks,\n  builder: typeof API = API\n) {\n  let applet: BuilderContext | undefined\n  let ctx: Record<string, Record<string, any>>\n  let request: supertest.Agent\n  let authHeader: string\n\n  beforeAll(async () => {\n    const started = new Date()\n\n    const aYearFromNow = new Date(started)\n    aYearFromNow.setDate(aYearFromNow.getDate() + 1)\n    aYearFromNow.setFullYear(aYearFromNow.getFullYear() + 1)\n\n    const aMonthFromNow = new Date(started)\n    aMonthFromNow.setDate(aMonthFromNow.getDate() + 1)\n    aMonthFromNow.setMonth(aMonthFromNow.getMonth() + 1)\n\n    try {\n      ctx = {\n        suite: {\n          now: Math.floor(started.getTime() / 1000),\n          monthFromNow: Math.floor(aMonthFromNow.getTime() / 1000),\n          yearFromNow: Math.floor(aYearFromNow.getTime() / 1000),\n        },\n        runner: runnerCtx,\n        cookies: {},\n        exports: {},\n        env: process.env,\n      }\n\n      const { config } = await import('../src/config')\n      if (!config.loaded) config.load()\n\n      ctx['config'] = config\n      setupLog(config)\n\n      if (typeof base !== 'string') {\n        applet = builder.create(base, config)\n        await applet?.listen()\n      }\n\n      const privateKey = process.env['TEST_JWT_PRIVATE_KEY']\n      if (privateKey) {\n        const priv = await Auth.parseKSAKey(privateKey)\n        debug('Running with a private key for signing - %s', priv)\n\n        authHeader = await sign(ctx.runner.jwt, priv)\n      } else if (config.get('token-api-key')) {\n        // Create a new admin style JWT, so ignore the one from the runnerCtx\n        authHeader = await (\n          await fetch('http://localhost:15678/tokens', {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n              'X-API-KEY': config.get('token-api-key'),\n            },\n            body: JSON.stringify(ctx.runner.jwt),\n          })\n        ).text()\n      } else {\n        throw new Error('Cannot run tests without a private key or api-key')\n      }\n      debug('Created an auth header - %o', authHeader)\n\n      const server = applet?.server?.raw\n      request = supertest.agent(server || (base as string))\n\n      hooks?.before && (await hooks?.before(applet, ctx, config))\n    } catch (err) {\n      // Log this out to stderr, ignore debug as we need to see this\n      _errorLogger(err)\n\n      await cleanup(applet)\n      return Promise.reject(err)\n    }\n  })\n\n  afterAll(async () => {\n    await (applet ? cleanup(applet) : {})\n    hooks?.after && (await hooks?.after(applet, ctx))\n  })\n\n  for (const flow of workflow) {\n    debug('Creating %s', flow.name ?? `${flow.method} - ${flow.route}`)\n\n    test(\n      flow.name ?? `${flow.method} - ${flow.route}`,\n      async function () {\n        return handler(flow, ctx, request)\n      },\n      flow.timeout ? flow.timeout + 1000 : 5000\n    )\n  }\n\n  async function handler(\n    flow: WorkFlow,\n    ctx: Record<string, Record<string, any>>,\n    request: supertest.Agent\n  ) {\n    // Allow for other hosts to be used during the flow, may we need to call an external service etc\n    const curr = flow.host ? supertest.agent(flow.host) : request\n\n    if (flow.wait) {\n      debug('Waiting %sms', flow.wait)\n      await sleep(flow.wait)\n    }\n\n    // Get the method\n    const method = <Lowercase<Methods>>flow.method.toLowerCase()\n\n    debug('Running %o with %o', flow.name || flow.route, {\n      ...ctx,\n      config: 'AppConfig',\n      env: 'process.env',\n    })\n\n    const route = parseInterpolation(flow.route, { ...ctx })\n    debug('Creating %s request for %s', flow.method, route)\n\n    // Generate the `request.(get|post|put|*)`\n    let req = curr[method](route)\n\n    // Add the body\n    if (flow.body) {\n      const body = parseBody(flow.body, { ...ctx })\n      debug('Sending %o', body)\n      req = req.send(body)\n    }\n\n    // Move over any headers\n    //\n    // Maybe add checks here to see if they're valid or not??\n    if (flow.headers) {\n      debug('Adding headers %o', flow.headers)\n      for (const [header, value] of Object.entries(flow.headers)) {\n        req = req.set(header, parseInterpolation(value, { ...ctx }))\n      }\n    }\n\n    // This is not ideal, but will work for now, jwt technically can be created w/ a DI as it only depends\n    // on config, in the test file, but would need describe to be async\n    if (flow.auth) {\n      const authIsString = typeof flow.auth === 'string'\n\n      if (!authHeader && !authIsString)\n        throw new Error('Unable to find an auth header')\n\n      req = req.auth(\n        authIsString\n          ? parseInterpolation(flow.auth as string, { ...ctx })\n          : authHeader,\n        { type: 'bearer' }\n      )\n    }\n\n    let res: supertest.Response\n    try {\n      res = await req\n      debug('Received %j', /text\\/.*/.test(res.type) ? res.text : res.body)\n    } catch (err) {\n      debug('Threw %o', err)\n      throw err\n    }\n\n    if (res.headers['st-access-token'] && !authHeader) {\n      authHeader = res.headers['st-access-token']\n    }\n\n    if (flow.tests) {\n      for (const [test, value] of Object.entries(flow.tests)) {\n        switch (test) {\n          case 'status':\n            expect(res.status).toEqual(value)\n            break\n          case 'content-type':\n            expect(res.type).toEqual(value)\n            break\n          case 'body':\n            expect(res.body).toMatchObject(\n              parseBody(value, { ...ctx }) as Record<string, any>\n            )\n            break\n          case 'not-body':\n            expect(res.body).not.toMatchObject(\n              parseBody(value, { ...ctx }) as Record<string, any>\n            )\n            break\n          default:\n            throw new Error('Not yet implemented')\n        }\n      }\n    }\n\n    if (flow.exports) {\n      for (const [key, value] of Object.entries(flow.exports)) {\n        switch (value) {\n          case 'status':\n            ctx.exports[key] = res.status\n            break\n          case 'body':\n            ctx.exports[key] = /text\\/.*/.test(res.type) ? res.text : res.body\n            break\n          default:\n            if (typeof value !== 'string' && 'path' in value) {\n              if (value.regex) {\n                const data = <string>require('lodash.get')(res.body, value.path)\n                const regex = new RegExp(`(?<${key}>${value.regex})`)\n                debug('exporting %s with %o from %s', key, regex, value.path)\n\n                const groups = data.match(regex)?.groups || {\n                  [key]: value.default,\n                }\n                ctx.exports[key] = groups[key]\n              } else {\n                ctx.exports[key] =\n                  require('lodash.get')(res, value.path) || value.default\n              }\n            } else {\n              ctx.exports[key] = require('lodash.get')(res, value)\n            }\n        }\n      }\n    }\n  }\n}\n\nfunction parseBody(\n  body: Array<Record<string, any>> | Record<string, any> | string,\n  context: Record<string, any>\n): Array<Record<string, any>> | Record<string, any> | string {\n  if (Array.isArray(body)) return body.map((el) => parseBody(el, context))\n\n  if (typeof body === 'string') {\n    return parseInterpolation(body, context)\n  }\n\n  const flattened = flatten(body)\n  for (const [key, value] of Object.entries(flattened)) {\n    flattened[key] = parseInterpolation(value, context)\n  }\n  return fatten(flattened)\n}\n\nfunction parseInterpolation(value: any, context: Record<string, any>) {\n  if (!interpolationRegex.test(value) || typeof value !== 'string') return value\n  interpolationRegex.lastIndex = 0\n\n  const itr = value.replaceAll(interpolationRegex, '%s')\n  const matches = Array.from(value.matchAll(interpolationRegex))\n    .map((el) => el[1].trim()) // Need to trim\n    .map((el) => {\n      const path = el.split('.')\n      if (path[0] === 'config' && context.config) {\n        return (<Config<AppConfig>>context.config).get(path[1])\n      }\n\n      return require('lodash.get')(context, path)\n    })\n\n  debug('interpolating %o with %o', value, matches)\n  return util.format(itr, ...matches)\n}\n\nexport function sleep(ms: number) {\n  return new Promise((resolve) => setTimeout(resolve, ms))\n}\n\nexport function sign(payload: object, priv: string): Promise<string> {\n  // const header = { alg: 'RS256' };\n  const opts: Record<any, any> = {}\n\n  const isPrivKey = isValidPrivateKey(priv)\n  if (isPrivKey) opts.header = { alg: 'RS256' }\n\n  return new Promise((resolve, reject) => {\n    JsonWebToken.sign(payload, priv, opts, (error, encoded) => {\n      if (error) return reject(error)\n\n      resolve(encoded!)\n    })\n  })\n}\n\nexport async function cleanup(\n  applet?:\n    | BuilderContext\n    | BaseContainer\n    | Container\n    | { get: <T>(v: ServiceIdentifier) => T | undefined },\n  container?:\n    | BaseContainer\n    | Container\n    | { get: <T>(v: ServiceIdentifier) => T | undefined }\n) {\n  if (!container && applet && applet instanceof BuilderContext) {\n    container = applet.container\n    await applet?.server?.close()\n\n    applet?.server?.removeAllListeners()\n  } else if (\n    !container &&\n    applet &&\n    (applet instanceof BaseContainer ||\n      applet instanceof Container ||\n      'get' in applet)\n  ) {\n    container = applet\n  }\n\n  const closers = []\n\n  try {\n    const database = container?.get<KyselyDatastore>(KyselyDatastore)\n\n    if (database) {\n      closers.push(database?.destroy())\n    }\n  } catch (err) {}\n\n  try {\n    // RabbitmqClient\n    const events = container?.get<RabbitmqClient>(RabbitmqClient)\n\n    if (events) {\n      closers.push((<RabbitmqClient>events).destroy())\n    }\n  } catch (err) {}\n\n  try {\n    // Abort\n    const bullmq = container?.get<BullHandler>(BullHandler)\n\n    if (bullmq) {\n      closers.push(bullmq.close(true))\n    }\n  } catch (err) {}\n\n  try {\n    // Abort\n    const abort = container?.get<Abort>(Abort)\n\n    if (abort) {\n      closers.push(abort.abort('clean_up'))\n    }\n  } catch (err) {}\n\n  if (closers.length === 0) return Promise.resolve()\n\n  // These are the given values, used by everything\n  return Promise.allSettled(closers)\n}\n\nexport function supertestLogger(res: supertest.Response) {\n  console.log('%j', res.body)\n}\n\nexport function testDebugLog(msg: any, ...args: any[]) {\n  if (process.env.NODE_ENV === 'test') {\n    console.trace(msg, ...args)\n  }\n}\n\nfunction _errorLogger(error: any) {\n  console.error(error)\n  console.debug(error)\n\n  if (error instanceof AggregateError) {\n    error.errors.map((err) => console.error(err))\n  }\n\n  if ('cause' in error) {\n    _errorLogger(error.cause)\n  }\n}\n"]}