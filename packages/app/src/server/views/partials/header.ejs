<!-- Header Bar -->
<header class="bg-base-100 border-b border-base-300 px-8 py-4">
  <div class="flex items-center justify-between gap-4">
    <h2 id="view-title" class="text-2xl font-semibold text-base-content">
      <%=
        currentView === 'dashboard' ? 'Dashboard' :
        currentView === 'suppliers' ? 'Suppliers' :
        currentView === 'ingredients' ? 'Ingredients' :
        currentView === 'recipes' ? 'Recipes' :
        currentView === 'margins' ? 'Margins' :
        currentView === 'settings' ? 'Settings' :
        currentView === 'help' ? 'Help' :
        'Menu Book'
      %>
    </h2>

    <!-- Search & Filters (only shown on management/margins views) -->
    <% if (['suppliers', 'ingredients', 'recipes', 'margins'].includes(currentView)) { %>
    <div
      id="search-filters"
      class="flex-1 max-w-2xl flex items-center gap-3"
    >
      <!-- Search Input -->
      <div class="relative flex-1">
        <div
          class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
        >
          <svg
            class="h-5 w-5 text-gray-400"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
            />
          </svg>
        </div>
        <input
          type="text"
          id="search-input"
          name="search"
          hx-get="/<%= currentView %>"
          hx-trigger="keyup changed delay:300ms"
          hx-target="#<%= currentView %>-list"
          hx-swap="innerHTML"
          hx-include="[name='filter-category'], [name='filter-class'], [name='filter-margin']"
          class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          placeholder="Search..."
        />
      </div>

      <!-- Filter Dropdown -->
      <div class="relative">
        <button
          id="filter-toggle"
          class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
        >
          <svg
            class="w-4 h-4 mr-2"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
            />
          </svg>
          Filters
          <span
            id="filter-count"
            class="ml-2 hidden inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
          >
            0
          </span>
        </button>

        <!-- Filter Dropdown Menu -->
        <div
          id="filter-menu"
          class="hidden absolute right-0 mt-2 w-72 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-10"
        >
          <div class="p-4 space-y-4">
            <!-- Filter by Supplier (for ingredients) -->
            <% if (currentView === 'ingredients') { %>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Supplier
              </label>
              <select
                id="filter-supplier"
                name="filter-supplier"
                hx-get="/<%= currentView %>"
                hx-trigger="change"
                hx-target="#<%= currentView %>-list"
                hx-swap="innerHTML"
                hx-include="[name='search'], [name='filter-category']"
                class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              >
                <option value="">All Suppliers</option>
                <% if (typeof suppliers !== 'undefined') { %>
                  <% suppliers.forEach(supplier => { %>
                    <option value="<%= supplier.id %>"><%= supplier.name %></option>
                  <% }); %>
                <% } %>
              </select>
            </div>
            <% } %>

            <!-- Filter by Category (for ingredients/recipes) -->
            <% if (['ingredients', 'recipes'].includes(currentView)) { %>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Category
              </label>
              <select
                id="filter-category"
                name="filter-category"
                hx-get="/<%= currentView %>"
                hx-trigger="change"
                hx-target="#<%= currentView %>-list"
                hx-swap="innerHTML"
                hx-include="[name='search'], [name='filter-class'], [name='filter-margin']"
                class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              >
                <option value="">All Categories</option>
                <% if (typeof categories !== 'undefined') { %>
                  <% categories.forEach(category => { %>
                    <option value="<%= category %>"><%= category %></option>
                  <% }); %>
                <% } %>
              </select>
            </div>
            <% } %>

            <!-- Filter by Class (for recipes) -->
            <% if (currentView === 'recipes') { %>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Class
              </label>
              <select
                id="filter-class"
                name="filter-class"
                hx-get="/<%= currentView %>"
                hx-trigger="change"
                hx-target="#<%= currentView %>-list"
                hx-swap="innerHTML"
                hx-include="[name='search'], [name='filter-category'], [name='filter-margin']"
                class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              >
                <option value="">All Classes</option>
                <option value="menu_item">Menu Item</option>
                <option value="base_template">Base Template</option>
                <option value="sub_recipe">Sub Recipe</option>
              </select>
            </div>
            <% } %>

            <!-- Filter by Margin (for margins view) -->
            <% if (currentView === 'margins') { %>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Margin Status
              </label>
              <select
                id="filter-margin"
                name="filter-margin"
                hx-get="/<%= currentView %>"
                hx-trigger="change"
                hx-target="#<%= currentView %>-list"
                hx-include="[name='search']"
                class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              >
                <option value="">All</option>
                <option value="below-target">Below Target</option>
                <option value="meets-target">Meets Target</option>
              </select>
            </div>
            <% } %>

            <!-- Clear Filters Button -->
            <button
              onclick="clearFilters()"
              class="w-full px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200"
            >
              Clear All Filters
            </button>
          </div>
        </div>
      </div>
    </div>
    <% } %>

    <!-- Theme Switcher -->
    <div class="dropdown dropdown-end">
      <label tabindex="0" class="btn btn-ghost btn-circle">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
        </svg>
      </label>
      <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-52">
        <li><a onclick="setTheme('light')">Light</a></li>
        <li><a onclick="setTheme('dark')">Dark</a></li>
        <li><a onclick="setTheme('cupcake')">Cupcake</a></li>
      </ul>
    </div>
  </div>
</header>

<script>
  // Theme switcher function
  function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme)
    localStorage.setItem('theme', theme)
  }
</script>

<script>
  // Filter toggle
  document.getElementById('filter-toggle')?.addEventListener('click', function() {
    document.getElementById('filter-menu')?.classList.toggle('hidden');
  });

  // Clear filters function
  function clearFilters() {
    document.getElementById('search-input').value = '';
    document.querySelectorAll('select[name^="filter-"]').forEach(select => {
      select.value = '';
    });
    // Trigger HTMX refresh
    htmx.trigger('#<%= currentView %>-list', 'refresh');
    document.getElementById('filter-menu')?.classList.add('hidden');
  }

  // Close filter menu when clicking outside
  document.addEventListener('click', function(event) {
    const filterToggle = document.getElementById('filter-toggle');
    const filterMenu = document.getElementById('filter-menu');
    if (filterToggle && filterMenu && !filterToggle.contains(event.target) && !filterMenu.contains(event.target)) {
      filterMenu.classList.add('hidden');
    }
  });
</script>
