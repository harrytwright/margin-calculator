<!doctype html>
<html lang="en" data-theme="menubook">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= typeof pageTitle !== 'undefined' ? pageTitle + ' | Menu Book' : 'Menu Book' %></title>

    <!-- Google Fonts: DM Serif Display + Plus Jakarta Sans -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Compiled Tailwind CSS with DaisyUI -->
    <link rel="stylesheet" href="/styles/output.css">

    <!-- Chart.js for Dashboard -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- HTMX for SPA-like interactions -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    <style>
      /* Custom font application */
      body {
        font-family: 'Plus Jakarta Sans', system-ui, sans-serif;
      }

      h1, h2, h3, .font-display {
        font-family: 'DM Serif Display', Georgia, serif;
      }

      /* Subtle texture overlay for warmth */
      .texture-overlay {
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
        opacity: 0.02;
        pointer-events: none;
      }

      /* Smooth page transitions */
      .page-transition {
        animation: slideUp 0.4s ease-out;
      }

      @keyframes slideUp {
        from { opacity: 0; transform: translateY(8px); }
        to { opacity: 1; transform: translateY(0); }
      }

      /* Card hover effects */
      .card-hover {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      .card-hover:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 30px -8px rgba(200, 90, 56, 0.15);
      }

      /* Link underline animation */
      .link-underline {
        position: relative;
      }
      .link-underline::after {
        content: '';
        position: absolute;
        width: 0;
        height: 2px;
        bottom: -2px;
        left: 0;
        background: currentColor;
        transition: width 0.2s ease;
      }
      .link-underline:hover::after {
        width: 100%;
      }

      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #d4c5b3;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #c4b5a3;
      }

      /* Table row hover */
      .table-row-hover:hover {
        background: linear-gradient(90deg, transparent, rgba(200, 90, 56, 0.04), transparent);
      }
    </style>

    <script>
      // Theme switcher - load saved theme on page load
      const savedTheme = localStorage.getItem('theme') || 'menubook'
      document.documentElement.setAttribute('data-theme', savedTheme)
    </script>
  </head>
  <body class="font-sans antialiased">
    <!-- Subtle texture overlay -->
    <div class="fixed inset-0 texture-overlay z-[-1]"></div>

    <!-- Modal Overlay -->
    <div
      id="modal-overlay"
      class="fixed inset-0 bg-neutral/60 backdrop-blur-sm hidden z-40 transition-all duration-300"
    ></div>

    <!-- Modal Container -->
    <div id="modal-container">
      <%- include('../partials/modal') %>
    </div>

    <!-- Toast Notification Container -->
    <div
      id="toast-container"
      class="fixed top-4 right-4 z-50 space-y-2 pointer-events-none"
    ></div>

    <!-- Delete Confirmation Modal -->
    <%- include('../partials/delete-modal') %>

    <!-- Guided Tour Overlay -->
    <%- include('../partials/tour-overlay') %>

    <!-- Main App -->
    <div id="app" class="min-h-screen flex">
      <!-- Sidebar -->
      <%- include('../partials/sidebar', { currentView: view || 'dashboard' }) %>

      <!-- Main Content Area -->
      <div id="content-area" class="flex-1 flex flex-col bg-base-200">
        <!-- Header -->
        <%- include('../partials/header', { currentView: view || 'dashboard' }) %>

        <!-- Page Content -->
        <main id="main-content" class="flex-1 p-8 overflow-auto">
          <div class="page-transition">
            <%- include(`../pages/${view}`) %>
          </div>
        </main>
      </div>
    </div>

    <!-- Shared JavaScript for SSE, Modals, Toast, Tour -->
    <script>
      // Toast notification function
      function showToast(message, type = 'info') {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');

        const styles = {
          success: 'bg-secondary text-white',
          error: 'bg-error text-white',
          warning: 'bg-warning text-warning-content',
          info: 'bg-primary text-white'
        };

        toast.className = `${styles[type]} px-5 py-3 rounded-lg shadow-warm-lg pointer-events-auto transform transition-all duration-300 translate-x-0 opacity-100 font-medium text-sm`;
        toast.textContent = message;

        container.appendChild(toast);

        // Animate in
        setTimeout(() => {
          toast.style.transform = 'translateX(0)';
          toast.style.opacity = '1';
        }, 10);

        // Remove after 3 seconds
        setTimeout(() => {
          toast.style.transform = 'translateX(100%)';
          toast.style.opacity = '0';
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }

      // Modal functions
      function openModal() {
        const modal = document.getElementById('modal');
        const overlay = document.getElementById('modal-overlay');
        const modalContent = modal.querySelector('.modal-content');

        modal.classList.remove('hidden');
        overlay.classList.remove('hidden');
        modal.classList.add('pointer-events-auto');

        // Trigger animation
        setTimeout(() => {
          modalContent.classList.remove('scale-95', 'opacity-0');
          modalContent.classList.add('scale-100', 'opacity-100');
        }, 10);
      }

      function closeModal() {
        const modal = document.getElementById('modal');
        const overlay = document.getElementById('modal-overlay');
        const modalContent = modal.querySelector('.modal-content');

        // Trigger close animation
        modalContent.classList.remove('scale-100', 'opacity-100');
        modalContent.classList.add('scale-95', 'opacity-0');

        setTimeout(() => {
          modal.classList.add('hidden');
          overlay.classList.add('hidden');
          modal.classList.remove('pointer-events-auto');

          // Clear modal content
          modalContent.innerHTML = '';
        }, 200);
      }

      // Close modal when clicking overlay
      document.getElementById('modal-overlay')?.addEventListener('click', closeModal);

      // Initialize on page load

      // HTMX configuration
      document.body.addEventListener('htmx:configRequest', (event) => {
        // Add custom headers if needed
        event.detail.headers['X-Requested-With'] = 'htmx';
      });

      // Handle HTMX errors
      document.body.addEventListener('htmx:responseError', (event) => {
        showToast('An error occurred. Please try again.', 'error');
      });

      // Handle HTMX success
      document.body.addEventListener('htmx:afterSwap', (event) => {
        // Re-initialize any JavaScript components in the swapped content
        // e.g., Chart.js charts, form validation, etc.
      });
    </script>
  </body>
</html>
